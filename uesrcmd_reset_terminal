#!/usr/bin/env bash
# uesrcmd_fix_nosort: One-click fix for 'complete: nosort: invalid option name' errors on macOS Bash

cat > ~/hard-reset-bash.sh <<'RST'
#!/usr/bin/env bash
set -euo pipefail
ts="$(date +%Y%m%d-%H%M%S)"
for f in "$HOME/.bash_profile" "$HOME/.bashrc" "$HOME/.profile"; do
  [ -e "$f" ] && cp -a "$f" "${f}.bak.${ts}" || true
done

cat > "$HOME/.bash_profile" <<'EOF'
export LANG=en_US.UTF-8
export LC_ALL=en_US.UTF-8
export LC_CTYPE=en_US.UTF-8
export LC_COLLATE=en_US.UTF-8
if [ -x /opt/homebrew/bin/brew ]; then eval "$(/opt/homebrew/bin/brew shellenv)"; fi
if [ -x /usr/local/bin/brew ]; then eval "$(/usr/local/bin/brew shellenv)"; fi
[ -r "$HOME/.bashrc" ] && . "$HOME/.bashrc"
EOF

cat > "$HOME/.bashrc" <<'EOF'
if [ -r /opt/homebrew/etc/profile.d/bash_completion.sh ]; then
  . /opt/homebrew/etc/profile.d/bash_completion.sh
elif [ -r /usr/local/etc/profile.d/bash_completion.sh ]; then
  . /usr/local/etc/profile.d/bash_completion.sh
fi
EOF
echo "Done. 重开终端即可。"
RST

chmod +x ~/hard-reset-bash.sh
bash ~/hard-reset-bash.sh